<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نتیجه آزمون</title>

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700;900&display=swap" rel="stylesheet">

<style>
body {
    background: #0d0d0d;
    color: #eee;
    font-family: 'Vazirmatn', sans-serif;
    padding: 30px;
}
.result-card {
    max-width: 900px;
    background: rgba(255,255,255,0.03);
    padding: 22px;
    margin: auto;
    border-radius: 14px;
    box-shadow: 0 0 30px rgba(0,0,0,0.45);
}
h1 {
    text-align: center;
    margin-bottom: 18px;
    font-size: 1.9rem;
    font-weight: 900;
    background: linear-gradient(90deg,#b6862e,#ffd700,#fff2b2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.result-grid { display:flex; gap:18px; flex-wrap:wrap; }
.left { flex:1 1 320px; }
.right { flex:1 1 320px; }

/* progress bars */
.result-item { margin-bottom: 14px; }
.result-item b { font-size:1rem; }
.bar-bg { width:100%; height:12px; background:#222; border-radius:10px; margin-top:6px; overflow:hidden; }
.bar { height:100%; background: linear-gradient(90deg,#4fa6ff,#ffd875); width:0%; border-radius:10px; transition:0.8s; }

/* top matches */
.match { padding:12px; margin-bottom:10px; background: rgba(255,255,255,0.03); border-radius:10px; display:flex; justify-content:space-between; align-items:center; }
.match b { font-size:1rem; }

.back-btn {
    margin-top: 16px;
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    background: #4fa6ff;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
}
</style>
</head>
<body>

<h1>نتیجهٔ آزمون شما — شباهت با پادشاهان</h1>

<div class="result-card" id="resultCard">
  <div class="result-grid">
    <div class="left" id="axesBox">
      <h3>پروفایل شما (محورها)</h3>
      <div class="result-item"><b>اقتدار ↔ آزادی</b>
        <div class="bar-bg"><div id="axis0" class="bar" style="width:0%"></div></div>
      </div>
      <div class="result-item"><b>بازار ↔ برابری</b>
        <div class="bar-bg"><div id="axis1" class="bar" style="width:0%"></div></div>
      </div>
      <div class="result-item"><b>سنت ↔ اصلاح</b>
        <div class="bar-bg"><div id="axis2" class="bar" style="width:0%"></div></div>
      </div>
      <div class="result-item"><b>مرز ↔ جهان</b>
        <div class="bar-bg"><div id="axis3" class="bar" style="width:0%"></div></div>
      </div>
    </div>

    <div class="right" id="matchesBox">
      <h3>پادشاهانِ شبیه به شما (رتبه‌بندی)</h3>
      <div id="topMatches"></div>
    </div>
  </div>

  <button class="back-btn" onclick="window.location.href='questions.html'">بازگشت و تکرار آزمون</button>
</div>

<script>
/* خواندن پاسخ‌ها */
const answers = JSON.parse(localStorage.getItem('quiz_answers') || '[]');

if (!answers || answers.length === 0){
  document.getElementById('resultCard').innerHTML = '<p style="text-align:center;font-size:1.2rem;">هیچ پاسخی یافت نشد. لطفاً آزمون را ابتدا تکمیل کنید.</p>';
  throw new Error('No answers');
}

/* ======== تبدیل پاسخ‌ها به 4 محور (0..100) ======== */
/*
  ما 30 سؤال داریم. تقسیم‌بندی به 4 محور:
  - محور0 (اقتدار): سوالات 0..7  (8 سوال)
  - محور1 (اقتصاد):   سوالات 8..15 (8 سوال)
  - محور2 (سنت/اصلاح): سوالات 16..22 (7 سوال)
  - محور3 (مرز/جهان): سوالات 23..29 (7 سوال)
*/
function computeAxes(arr){
  const groups = [
    {from:0, to:7},   // 8 q
    {from:8, to:15},  // 8 q
    {from:16, to:22}, // 7 q
    {from:23, to:29}  // 7 q
  ];

  const axes = groups.map(g=>{
    let sum = 0;
    let n = g.to - g.from + 1;
    for(let i=g.from;i<=g.to;i++){
      const v = (arr[i] !== undefined) ? Number(arr[i]) : 50;
      sum += (v - 50); // centered -50..+50
    }
    const maxSum = 50 * n; // if all were 100 => each v-50=50
    // map sum (-maxSum .. +maxSum) to 0..100
    const score = Math.round(((sum / maxSum) + 1) * 50);
    return Math.max(0, Math.min(100, score));
  });

  return axes; // [axis0..axis3]
}

const userAxes = computeAxes(answers);

/* ======== پروفایل پادشاهان (چهار محوره) ========
   این پروفایل‌ها از تحلیل تاریخی نمونه‌سازی شده‌اند.
   هر عدد 0..100 اندازه‌گیری گرایش آن پادشاه روی آن محور است.
*/
const kings = {
  // === هخامنشیان ===
  "کوروش بزرگ":        [40, 55, 25, 20],
  "کمبوجیه":            [80, 40, 70, 75],
  "داریوش بزرگ":        [95, 70, 55, 65],
  "خشایارشا":           [98, 50, 80, 90],

  // === اشکانیان ===
  "مهرداد یکم":         [70, 40, 60, 85],
  "بلاش یکم":           [45, 35, 55, 35],
  "فرهاد چهارم":        [85, 30, 70, 75],

  // === ساسانیان ===
  "اردشیر بابکان":      [95, 45, 90, 80],
  "شاپور یکم":           [75, 60, 65, 85],
  "خسرو انوشیروان":     [90, 80, 55, 55],
  "یزدگرد سوم":         [30, 40, 35, 25],

  // === صفویان ===
  "شاه اسماعیل":        [95, 20, 95, 70],
  "شاه طهماسب":         [65, 30, 85, 55],
  "شاه عباس":           [85, 75, 40, 60],

  // === افشاریه / زند ===
  "نادرشاه":            [100, 50, 60, 100],
  "کریم‌خان زند":       [35, 65, 20, 30],

  // === قاجار ===
  "آقامحمدخان":         [100, 30, 75, 95],
  "فتحعلی‌شاه":         [60, 35, 70, 40],
  "ناصرالدین‌شاه":      [70, 55, 45, 50],
  "احمدشاه":            [25, 45, 35, 20],

  // === پهلوی ===
  "رضاشاه":             [95, 80, 35, 55],
  "محمدرضاشاه":         [65, 85, 30, 40]
};


/* ======== محاسبهٔ شباهت (نرمالایز شده) ======== */
function similarityScore(u, k){
  // Euclidean distance normalized to 0..1 then converted to percent similarity
  let sumsq = 0;
  for(let i=0;i<4;i++){
    const d = u[i] - k[i];
    sumsq += d*d;
  }
  const dist = Math.sqrt(sumsq);
  const maxDist = Math.sqrt(4 * 100 * 100); // 200
  const sim = Math.round((1 - dist / maxDist) * 100);
  return Math.max(0, Math.min(100, sim));
}

/* ======== نمایش محورها ======== */
document.getElementById('axis0').style.width = userAxes[0] + '%';
document.getElementById('axis1').style.width = userAxes[1] + '%';
document.getElementById('axis2').style.width = userAxes[2] + '%';
document.getElementById('axis3').style.width = userAxes[3] + '%';

/* ======== محاسبه و مرتب‌سازی پادشاهان ======== */
const results = [];
Object.keys(kings).forEach(name=>{
  const sim = similarityScore(userAxes, kings[name]);
  results.push({name, sim});
});
results.sort((a,b)=> b.sim - a.sim);

/* ======== نشان دادن 5 نتیجهٔ برتر و همه ======== */
const topBox = document.getElementById('topMatches');
topBox.innerHTML = '';

// top 5
topBox.innerHTML += '<h4>برترین شباهت‌ها</h4>';
results.slice(0,5).forEach(r=>{
  topBox.innerHTML += `<div class="match"><b>${r.name}</b><span>${r.sim}%</span></div>`;
});

// full list with bars
topBox.innerHTML += '<h4 style="margin-top:12px">کل پادشاهان (مرتب‌شده)</h4>';
results.forEach(r=>{
  topBox.innerHTML += `
    <div class="result-item">
      <b>${r.name}</b> — ${r.sim}% شباهت
      <div class="bar-bg"><div class="bar" style="width:${r.sim}%"></div></div>
    </div>
  `;
});

</script>

</body>
</html>

